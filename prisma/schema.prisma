generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql" 
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(cuid())
  name          String?
  email         String?   @unique
  password      String?   
  emailVerified DateTime?
  image         String?
  groqkey       String?   
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  Contests  Contest[]  @relation("Creator")
  Results   Result[] 
  feedback      Feedback[]
}


model Contest {
  id             String      @id @default(cuid())
  title          String
  description    String
  topics         String[]    @db.VarChar(191)
  difficulty     String
  startTime      DateTime
  endTime        DateTime
  durationMinutes       Int
  isPublic       Boolean     @default(true)
  passwordHash   String?     
  createdById    String
  createdBy      User        @relation(fields: [createdById], references: [id], name: "Creator")
  problems       Problem[]
  resultsVisible Boolean     @default(false)
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt
  results        Result[]
  contestants     ContestStudent[]
}

model ContestStudent {
  id        String   @id @default(cuid())
  contestId String
  email     String
  attempted Boolean  @default(false)
  startedAt DateTime?

  contest     Contest  @relation(fields: [contestId], references: [id], onDelete: Cascade)
  @@unique([contestId, email])

}


model Problem {
  id               String   @id @default(cuid())
  contestId        String?
  contest          Contest?  @relation(fields: [contestId], references: [id])
  problemName      String
  topics           String[]
  difficulty       String
  description      String   @db.Text
  returnformat     String?
  examples         Json
  testcases        Json     
  constraints      String[]
  comments         String[]
  solutions        Json
  createdAt        DateTime @default(now())
}

model Result {
  id          String   @id @default(cuid())
  contestId   String
  userId      String
  username    String       
  score       Int
  solvedCount Int
  details     Json?
  submissions Submission[]
  createdAt   DateTime @default(now())

  contest     Contest  @relation(fields: [contestId], references: [id])
  user        User     @relation(fields: [userId], references: [id])
  
  @@unique([contestId, userId]) 
}


model Submission {
  id          String   @id @default(cuid())
  resultId    String
  result      Result @relation(fields: [resultId], references: [id])
  problemId   String
  language    String
  code        String   @db.Text
  status      String   
  timeTakenMs Int?
  submittedAt DateTime @default(now())
}

model Feedback {
  id        String   @id @default(cuid())
  userId    String
  feedback   String   @db.Text
  anonymous Boolean  @default(false)
  rating   Int?    
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}